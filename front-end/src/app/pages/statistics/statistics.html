<div class="statistics-page">
  <h1>Patient Statistics</h1>

  @if (isLoading()) {
  <div class="loading-container">
    <mat-spinner diameter="40"></mat-spinner>
    <p>Loading statistics...</p>
  </div>
  } @else {
  <!-- Summary Cards -->
  <div class="summary-grid">
    <mat-card class="summary-card">
      <mat-card-content>
        <span class="stat-number">{{ totalPatients() }}</span>
        <span class="stat-label">Total Patients</span>
      </mat-card-content>
    </mat-card>

    <mat-card class="summary-card">
      <mat-card-content>
        <span class="stat-number">{{ patientsWithColor() }}</span>
        <span class="stat-label">With Favorite Color</span>
      </mat-card-content>
    </mat-card>

    <mat-card class="summary-card">
      <mat-card-content>
        <span class="stat-number">{{ patientsWithoutColor() }}</span>
        <span class="stat-label">No Color Selected</span>
      </mat-card-content>
    </mat-card>
  </div>

  <!-- Color Preference Cards -->
  <h2>Favorite Colors</h2>
  <p class="section-description">Number of patients who prefer each color</p>

  <div class="colors-grid">
    @for (stat of colorStats(); track stat.color.id) {
    <mat-card class="color-card" [style.border-color]="stat.color.hexCode">
      <mat-card-content>
        <span class="patient-count">{{ stat.count }}</span>
        <span class="color-name">{{ stat.color.name }}</span>
        <span class="patient-label">{{ stat.count === 1 ? 'patient' : 'patients' }}</span>
      </mat-card-content>
    </mat-card>
    }
  </div>

  <!-- Colors by Age Group -->
  <h2>Favorite Colors by Age Range</h2>
  <p class="section-description">Prefered colors for each age range group</p>

  <div class="age-groups-grid">
    @for (ageRangeColors of favoriteColorPatientsCountByAgeRange().values(); track ageRangeColors) {
    <mat-card class="age-group-card">
      <mat-card-header>
        <mat-card-title class="age-range-title">
          {{ ageRangeColors[0].ageRange.from }} - {{ ageRangeColors[0].ageRange.to }} years
        </mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <ul class="color-list">
          @for (item of ageRangeColors; track item.favoriteColor.id) {
          <li class="color-list-item">
            <span class="color-indicator" [style.background-color]="item.favoriteColor.hexCode"></span>
            <span class="color-name">{{ item.favoriteColor.name }}</span>
            <span class="color-count">{{ item.patientsCount }}
              {{ item.patientsCount === 1 ? 'patient' : 'patients' }}
            </span>
          </li>
          }
        </ul>
      </mat-card-content>
    </mat-card>
    }
  </div>

  @if (colorStats().length === 0) {
  <div class="empty-state">
    <p>No colors available to display statistics.</p>
  </div>
  }
  }
</div>